<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>Quote Lookup</title>
    <script src="/static/js/jquery-3.1.1.js"></script>
    <script>
        $(function(){
            quotename = $('a');
            quotename.on('click', function(e) { submitQuote(e.target.text);});
        });
    </script>
</head>
<body>
    <h1>Quote查询</h1>
    <div>
        <form id="quote-form" action="/api/results" method="get" onsubmit="return true" target="_blank">
            <input type="text" id="quote" name="lookup">
            <button type="button" onclick="submitQuote()">查询</button>
        </form>
    </div>
    <div>
        <h3>最多查询：</h3>
        {% for lookup in lookups%}
        <a href="#0">{{ lookup.symbol }}</a>
        {% endfor %}
    </div>
    <div>
        <table>
            <tr id="results">
                <th>日期</th>
                <th>开盘价</th>
                <th>最高价</th>
                <th>最低价</th>
                <th>收盘价</th>
                <th>修正收盘价*</th>
                <th>成交量</th>
            </tr>
        </table>
    </div>
    <script>
        function submitQuote(quotename='') {
            var quote = $('#quote');
            if (quotename){
                quote.val(quotename)
            }
            $.ajax('/api/results?lookup=' + quote.val(), {
                type: "GET",
                dataType: "json",
                success: function(data){
                    // location.assign('/')
                    // alert(data.timestamp.length)
                    var tr = $('#results');
                    $('tr[id!=results]').remove();
                    for (var i=0; i<data.timestamp.length; i++) {
                        date = new Date(data.timestamp[i] * 1000);
                        tr.after('<tr><td>' + date.toLocaleDateString()  +
                                    '</td><td>' + data.open[i].toFixed(2)  +
                                    '</td><td>' + data.high[i].toFixed(2)  +
                                    '</td><td>' + data.low[i].toFixed(2)  +
                                    '</td><td>' + data.close[i].toFixed(2)  +
                                    '</td><td>' + data.close[i].toFixed(2)  +
                                    '</td><td>' + data.volume[i]  + '</td></tr>')
                    };

                }
            });
        }
    </script>
</body>
</html>